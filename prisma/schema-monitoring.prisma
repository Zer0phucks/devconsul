// Monitoring and Performance Tracking Schema
// Add these models to your main schema.prisma file

// Job performance metrics
model JobMetrics {
  id               String   @id @default(cuid())
  jobId            String   @unique
  totalExecutions  Int      @default(0)
  successCount     Int      @default(0)
  failureCount     Int      @default(0)
  totalDurationMs  BigInt   @default(0)
  minDurationMs    Int      @default(0)
  maxDurationMs    Int      @default(0)
  lastExecutionAt  DateTime?
  lastSuccessAt    DateTime?
  lastFailureAt    DateTime?
  metadata         Json     @default("{}")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([jobId])
  @@index([lastExecutionAt])
}

// Performance baselines for regression detection
model PerformanceBaseline {
  id             String   @id @default(cuid())
  jobId          String   @unique
  baselineAvgMs  Float
  baselineP95Ms  Float
  sampleSize     Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([jobId])
}

// Dead letter queue for failed jobs
model DeadLetterQueue {
  id             String   @id @default(cuid())
  jobId          String
  eventData      Json
  error          String
  metadata       Json     @default("{}")
  status         String   @default("PENDING") // PENDING, PROCESSING, SUCCEEDED, FAILED
  attempts       Int      @default(0)
  lastAttemptAt  DateTime?
  processedAt    DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([jobId])
  @@index([status])
  @@index([createdAt])
}

// Alert tracking
model Alert {
  id         String   @id @default(cuid())
  type       String
  severity   String
  title      String
  message    String   @db.Text
  metadata   Json     @default("{}")
  resolved   Boolean  @default(false)
  resolvedAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([type])
  @@index([severity])
  @@index([resolved])
  @@index([createdAt])
}
